<!DOCTYPE html> <html lang="en"> <head> <meta charset="UTF-8"> <title>Yii2 - Интернационализация проекта (мультиязычность) | Atoumus Blog</title> <link rel="alternate" href="http://atoumus.github.io/yii2-i18n.html" hreflang="ru" /> <link rel="alternate" href="http://atoumus.github.io/en/" hreflang="en" /> <link rel="alternate" type="application/atom+xml" title="Atoumus Blog" href="/atom.xml" /> <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"> <link rel="stylesheet" type="text/css" href="/css/libs/flaticon/flaticon.css"> <link rel="stylesheet" type="text/css" href="/css/libs/prism.css"> <link rel="stylesheet" type="text/css" href="/css/libs/prism-fix.css"> <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.1.25/jquery.fancybox.min.css" /> <link rel="stylesheet" type="text/css" href="/css/common.css"> </head> <body> <a href="#top" class="elevator"><span class="flaticon-upwards-arrow"></span></a> <a name="top"></a> <div class="main"> <div class="header"> <a href="/" class="logo" title="Atoumus Blog" ><img src="/images/logo.png">Atoumus Blog</a> <form class="search" action="//google.com/search" target="_blank" method="get" accept-charset="UTF-8"> <input type="search" name="q" class="search-input"> <button type="submit">Поиск</button> <input type="hidden" name="sitesearch" value="http://atoumus.github.io"> </form> <div class="social"> <a href="#" class="search-toggle flaticon-magnifier" title="Поиск"></a> <a href="/atom.xml" target="_blank" class="flaticon-rss-feed-button" title="Atom лента"></a> <a href="https://twitter.com/atoumus/" target="_blank" class="flaticon-twitter-logo-silhouette" title="Twitter"></a> <a href="https://plus.google.com/u/0/116624784918762784912" target="_blank" class="flaticon-google-plus-logo-button" title="G+"></a> </div> </div> <div class="clear-both"></div> <div class="menu"> <div class="tags"> <a href='/'>Главная</a><a href='/tag/Yii/' class='selected'>Yii</a><a href='/tag/Books/'>Книги</a><a href='/tag/PHP/'>PHP</a><a href='/tag/Learning/'>Обучение</a><a href='/tag/Others/'>Прочее</a> </div> <div class="lang-switcher"> <span>ru</span><a href='/en/'>en</a> </div> </div> <div class="clear-both"></div> <div class="contents"> <div class="article"> <h1>Yii2 - Интернационализация проекта (мультиязычность)</h1> <div class="meta"> <div> <span class="flaticon-calendar-with-spring-binder-and-date-blocks"></span> 2016-08-12 </div> <div> <span class="flaticon-commerce"></span> <a href='/tag/Yii/'>Yii</a> </div> <div class="comments-number"> <span class="flaticon-comment-white-oval-bubble"></span> <a href="#comments" data-disqus-url="http://atoumus.github.io/yii2-i18n.html"></a> </div> </div> <div class="clear-both"></div> <div class="text"><p>Рассмотрим пример интернационализации сайта на Yii2 на двух языках: ru и en.</p>   <p>В Yii2 уже встроен компонент отвечающий за интернационализацию, называется он <code>i18n</code>. Для того что бы можно было начать им пользоваться, достаточно добавить его в конфигурацию приложения в раздел <code>components</code>. Также, для полноценной работы этого компонента, требуется PHP расширение <a target="_blank" href="http://www.php.net/manual/en/intro.intl.php">intl</a>.</p> <p>В данной статье будет рассмотрен пример интернационализации сайта на Yii2 на двух языках: ru и en.</p> <p>Существуют два варианта записей идентификаторов языков:</p> <ul> <li>сокращенные, например ru, en;</li> <li>полные, например: ru-RU, en-US.</li> </ul> <p>Мы будем использовать сокращенный вариант (ru и en), т.к. его вполне достаточно для требуемой функциональности и он более лаконично воспринимается визуально.</p> <p>В качестве кодовой базы можно использовать как уже готовый сайт на Yii2, так и basic шаблон предоставляемый фреймворком. Как установить basic шаблон можно прочитать в <a target="_blank" href="/yii2-basic-advanced.html">этой статье</a>.</p> <h2>Задача</h2> <p>Сформулируем требования, чего необходимо добиться:</p> <ul> <li>переключение сайта между двумя языками: ru и en;</li> <li>отображение языка в адресной строке в виде <code>http://site.com/en/</code>;</li> <li>автоматическое перенаправление пользователя на наиболее подходящий для него язык, если он перешел на сайт без указания языка;</li> <li>хранение переводов должно осуществляется в PHP файлах в виде массивов;</li> <li>переводы статических страниц должны содержаться в отдельных представлениях для разных языков.</li> </ul> <h2>Конфигурация</h2> <p>Начинаем реализацию с прописывания требуемых для этого конфигураций в файл <code>\config\web.php</code>:</p> <pre class="line-numbers"><code class="language-php">[
    ...
    'sourceLanguage' =&gt; 'en',
    'language' =&gt; 'en',
    ...
    'components' =&gt; [
        ...
        'urlManager' =&gt; [
            'enablePrettyUrl' =&gt; true,
            'showScriptName' =&gt; false,
            'rules' =&gt; [
            ],
        ],
        ...
        'i18n' =&gt; [
            'translations' =&gt; [
                'common*' =&gt; [
                    'class' =&gt; 'yii\i18n\PhpMessageSource',
                    'basePath' =&gt; '@app/messages',
                ],
            ],
        ],
        ...
    ]
]</code></pre> <p>В этой конфигурации:</p> <p><code>sourceLanguage</code> - исходный язык сообщений, т.е. тот который будет использован в виде ключей переводов, в данном случае <code>en</code>.</p> <p><code>language</code> - язык по умолчанию, на который будет перенаправлен пользователь в случае невозможности определения для него наиболее подходящего языка на основе данных предоставляемых его браузером.</p> <p><code>components -&gt; urlManager</code> - в данной секции включаем ЧПУ, для более наглядного отображения URL'ов.</p> <p><code>components -&gt; i18n</code> - эта секция предназначена для конфигурирования компонента интернационализации. Ключ массива <code>common*</code> - означает категорию к которой будут относиться переводы из соответствующего файла <code>common.php</code>. Название категории можно указать и любое другое, или например сделать несколько категорий, но для примера обойдемся одной. В секции <code>'class' =&gt; 'yii\i18n\PhpMessageSource'</code> необходимо указать как именно мы будем хранить сообщения, в данном случае указано что в виде PHP файлов (в виде ассоциативных массивов). Кроме <code>yii\i18n\PhpMessageSource</code> существуют и другие варианты, например сообщения можно хранить в БД. В секции <code>'basePath' =&gt; '@app/messages'</code> указан путь по которому будут располагаться PHP файлы с переводами.</p> <h2>Файл со списком переводов</h2> <p>Теперь необходимо создать PHP файл, который будет содержать в себе ассоциативный массив с переводами.</p> <p>При конфигурировании компонента <code>i18n</code> мы указали:</p> <pre class="line-numbers"><code class="language-php">...
'translations' =&gt; [
    'common*' =&gt; [
        'class' =&gt; 'yii\i18n\PhpMessageSource',
        'basePath' =&gt; '@app/messages',
    ],
],
...</code></pre> <p>Это означает что файл с переводами должен иметь такое же имя, как и имя категории, т.е. <code>common.php</code>. Храниться он должен по такому пути <code>\messages\ru\common.php</code>.</p> <p>Для нашего примера с двумя языками (ru и en), достаточно создать один файл с переводами только для русского языка, т.к. переводы английского языка будут в виде ключей для всех остальных переводов. Т.е. везде по сайту будут английские сообщения, при переключении на русский язык, фреймворк будет их подменять на русские.</p> <p>Например если бы мы хотели добавить какой либо дополнительный язык, например <code>de</code>, то кроме файла <code>\messages\ru\common.php</code> нам нужно было бы еще создать аналогичный для немецкого языка <code>\messages\de\common.php</code>. Но в нашем примере будет только один файл <code>\messages\ru\common.php</code>, создадим его, пока с пустым массивом:</p> <pre class="line-numbers"><code class="language-php">&lt;?php

return [];</code></pre> <h2>Вносим переводы</h2> <p>Теперь необходимо внести переводы по коду сайта и также добавить их в файл <code>\messages\ru\common.php</code>.</p> <p>Для вывода переводов в Yii2 существует специальный метод <code>Yii::t()</code>. Пример использования:</p> <pre><code class="language-php">&lt;?= Yii::t('common', 'Example text...') ?&gt;</code></pre> <p>В первом аргументе указываем категорию, у нас она одна - <code>common</code>. Во втором аргументе пишем английский текст в том виде как он должен отображаться на сайте.</p> <p>После этого необходимо добавить русский перевод в файл <code>\messages\ru\common.php</code>:</p> <pre class="line-numbers"><code class="language-php">return [
    ...
    'Example text...' =&gt; 'Пример текста...',
    ...
];</code></pre> <p>В качестве ключа используем английский перевод, а в качестве значения русский.</p> <p>Необходимо проделать такие действия по всему коду, т.е. все отображаемые тексты позаменять на английские, причем выводить их надо с помощью <code>Yii::t()</code>. И также добавить для всех английских текстов переводы в файл <code>\messages\ru\common.php</code>.</p> <h2>Переключение языков</h2> <p>У пользователя должна быть возможность как то переключаться между языками. Для этого необходимо отображать ссылки для переходя на русский или английский язык. Для этой цели создадим специальный скрипт представления <code>\views\layouts\main\select-language.php</code>:</p> <pre class="line-numbers"><code class="language-php">&lt;?php

use yii\bootstrap\Html;

if(\Yii::$app-&gt;language == 'ru'):
    echo Html::a('Go to English', array_merge(
        \Yii::$app-&gt;request-&gt;get(),
        [\Yii::$app-&gt;controller-&gt;route, 'language' =&gt; 'en']
    ));
else:
    echo Html::a('Перейти на русский', array_merge(
        \Yii::$app-&gt;request-&gt;get(),
        [\Yii::$app-&gt;controller-&gt;route, 'language' =&gt; 'ru']
    ));
endif;</code></pre> <p>Далее необходимо подключить этот скрипт в главном шаблоне представления <code>\views\layouts\main.php</code>, для этого следующую строку:</p> <pre><code class="language-php">&lt;p class="pull-left"&gt;&amp;copy; My Company &lt;?= date('Y') ?&gt;&lt;/p&gt;</code></pre> <p>нужно заменить на:</p> <pre><code class="language-php">&lt;p class="pull-left"&gt;&amp;copy; My Company &lt;?= date('Y') ?&gt; | &lt;?= $this-&gt;render('main/select-language') ?&gt;&lt;/p&gt;</code></pre> <p>В этой строке мы добавили рендеринг скрипта представления для переключения языков, благодаря ему в футере будет отображаться ссылка для перехода на другой язык. Выглядеть это будет примерно так:</p> <p style="text-align: center;"><img src="/images/ru/articles/2016-08-12-yii2-i18n/yii2-i18n-1.png" alt="Yii2 - Интернационализация проекта" /></p> <h2>Использование стороннего UrlManager</h2> <p>Теперь нам необходимо сделать так, что бы в строке адреса отображался текущий язык, например <code>http://site.com/en</code>. К сожалению Yii2 не предоставляет для этого каких либо встроенных возможностей, и даже сделать это какими то адекватными обходными путями не получиться, или по крайней мере сложно. Самым &quot;правильным&quot; выходом в этой ситуации будет переопределение стандартного класса <code>yii\web\UrlManager</code> на свой собственный, в котором будут заменены некоторые методы. Эти замененные методы должны брать на себя реализацию отображения языка в строке адреса.</p> <p>Вообще замена стандартных классов фреймворка на сторонние, лично на мой взгляд это хард-код. Но судя по всему в рамках фреймворка Yii2 это к сожалению нормальная практика.</p> <p>Писать собственную реализацию класса <code>UrlManager</code> мы не будем, т.к. данный &quot;велосипед&quot; уже создан и его можно просто подключить через Composer, что мы и сделаем. Переходим в консоле в корневую папку проекта, и выполняем команду (тут имеется ввиду что Composer установлен глобально):</p> <pre><code class="language-bash">$ composer require codemix/yii2-localeurls</code></pre> <p>Пакет <code>codemix/yii2-localeurls</code> дает нам следующие возможности:</p> <ul> <li>отображение текущего языка в адресной строке;</li> <li>перенаправление пользователя на наиболее подходящий для него язык на основе данных отправляемых его браузером.</li> </ul> <p>Далее нам нужно переконфигурировать компонент <code>urlManager</code> так, что бы он использовал не стандартный класс фреймворка, а только что подключенный. Для этого в файле <code>\config\web.php</code>, в секцию <code>componets -&gt; urlManager</code> добавляем следующие три строки:</p> <pre class="line-numbers"><code class="language-php">[
    ...
    'components' =&gt; [
        ...
        'urlManager' =&gt; [
            ...
            'class' =&gt; 'codemix\localeurls\UrlManager',
            'languages' =&gt; ['ru', 'en'],
            'enableDefaultLanguageUrlCode' =&gt; true,
            ...
        ],
        ...
    ]
    ...
]</code></pre> <p>Немного объяснений по данной конфигурации:</p> <p><code>'class' =&gt; 'codemix\localeurls\UrlManager'</code> - указываем фреймворку что бы вместо стандартного класса <code>UrlManager</code> был использован тот который мы только что подключили через Composer.</p> <p><code>'languages' =&gt; ['ru', 'en']</code> - на какие языки переведен проект.</p> <p><code>'enableDefaultLanguageUrlCode' =&gt; true</code> - этот флаг означает что мы ходим что бы текущий язык отображался в адресной строке всегда, даже если пользователь просто находиться на главной странице (т.е. адрес будет вида <code>http://site.com/en</code>). При желании этот флаг можно и не указывать, по умолчанию он будет иметь значение <code>false</code>, что означает что на главной странице язык в адресной строке отображаться не будет (т.е. адрес будет вида <code>http://site.com</code>). </p> <h2>Интернационализация статических страниц</h2> <p>В Yii2 есть встроенный класс <code>\yii\web\ViewAction</code>, который предназначен для реализации статических страниц.</p> <p>Но по умолчанию интернационализацию он не поддерживает.</p> <p>Суть в том, что статические страницы имеют большой текст, который не удобно вставлять в файлы переводов (т.е. в нашем случае в файл <code>\messages\ru\common.php</code>). Переводы для статических страниц лучше всего хранить в отдельных файлах - в разных скриптах преставлений которые будут соответствовать разным языкам.</p> <p>Реализуем интернационализированные статические страницы, для этого в файле <code>\controllers\SiteController.php</code>, в методе <code>actions()</code> необходимо добавить следующую секцию:</p> <pre class="line-numbers"><code class="language-php">public function actions()
{
    return [
        ...
        'page' =&gt; [
            'class' =&gt; \yii\web\ViewAction::className(),
            'viewPrefix' =&gt; 'pages/' . \Yii::$app-&gt;language
        ]
        ...
    ];
}</code></pre> <p>В этой секции и находиться основной код который позволяет интернационализировать статические страницы, это <code>'viewPrefix' =&gt; 'pages/' . \Yii::$app-&gt;language</code>. В параметре <code>viewPrefix</code> мы указываем по какому пути у нас будут находиться скрипты представлений для статических страниц, но в нашем случае мы еще и подставляем в этот путь текущий язык <code>\Yii::$app-&gt;language</code>.</p> <p>Далее создадим два файла представления, которые будут соответствовать одной статической странице, но каждый будет для своего языка. Для английского <code>\views\site\pages\en\some.php</code> должен содержать текст: <code>EN static page...</code>. Для русского <code>\views\site\pages\ru\some.php</code> должен содержать текст <code>Русская статическая страница...</code>.</p> <p>Теперь настроим ЧПУ для наглядного отображения адресов статических страниц, для этого в конфиге <code>\config\web.php</code> в секцию <code>urlManager -&gt; rules</code> добавим правило:</p> <pre class="line-numbers"><code class="language-php">'urlManager' =&gt; [
    ...
    'rules' =&gt; [
        'page/&lt;view:[a-zA-Z0-9-]+&gt;' =&gt; 'site/page',
    ],
    ...
],</code></pre> <p>На этом, реализация статических страниц закончена, можно проверить, попробовать открыть два адреса в браузере:</p> <ul> <li><code>http://site.com/ru/page/some</code> - откроется русская статическая страница;</li> <li><code>http://site.com/en/page/some</code> - английская.</li> </ul> <h2>Заключение</h2> <p>В целом реализация интернационализации в Yii2 не представляет ничего сложного, особенно если использовать сторонний компонент <code>codemix/yii2-localeurls</code>.</p> <p>Задача, которая была описана в начале статьи полностью выполнена:</p> <ul> <li>переключение сайта между двумя языками происходит по ссылке которая расположена в футере;</li> <li>текущий язык отображается в адресной строке в виде <code>http://site.com/en/</code>;</li> <li>если пользователь перешел на сайт не указав язык (т.е. <code>http://site.com</code>), то он будет перенаправлен на наиболее подходящий язык (т.е. например на <code>http://site.com/en</code>);</li> <li>хранение переводов осуществляется в PHP файлах в виде ассоциативных массивов;</li> <li>переводы статических страниц хранятся в отдельных представлениях для разных языков.</li> </ul></div> <div class="related"> <h2>Читайте также</h2> <a href="/yii2-swiftmailer.html" target="_blank" >Yii2 - Отправка писем с помощью Swiftmailer</a> <a href="/yii2-flash-messages.html" target="_blank" >Yii2 - Отображение флеш (пользовательских) сообщений на сайте</a> <a href="/yii2-basic-advanced.html" target="_blank" >Yii2 - Установка basic и advanced шаблонов приложения через Composer</a> <a href="/book-web-dev-yii2.html" target="_blank" >Книги - Разработка веб-приложений в Yii 2 (Марк Сафронов)</a> </div> <div class="share">Поделится: <script type="text/javascript">(function () { if (window.pluso) if (typeof window.pluso.start == "function") return; if (window.ifpluso == undefined) { window.ifpluso = 1; var d = document, s = d.createElement('script'), g = 'getElementsByTagName'; s.type = 'text/javascript'; s.charset = 'UTF-8'; s.async = true; s.src = ('https:' == window.location.protocol ? 'https' : 'http') + '://share.pluso.ru/pluso-like.js'; var h = d[g]('body')[0]; h.appendChild(s); } })();</script> <div class="pluso" data-background="transparent" data-options="small,round,line,horizontal,counter,theme=04" data-services="vkontakte,odnoklassniki,facebook,twitter,google,moimir,email,print"></div></div>   <div class="comments"> <a name="comments"></a> <div id="disqus_thread"></div> <script> var disqus_config = function () { this.page.url = "http://atoumus.github.io/yii2-i18n.html"; this.page.identifier = "yii2-i18n"; this.language = "ru"; }; (function() { var d = document, s = d.createElement('script'); s.src = 'https://atoumus.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript> </div> </div> </div> <div class="footer"> <div class="left"> <div class="social"> <a href="#" class="icon search-toggle flaticon-magnifier" title="Поиск"></a> <a href="/atom.xml" target="_blank" class="icon flaticon-rss-feed-button" title="Atom лента"></a> <a href="https://twitter.com/atoumus/" target="_blank" class="icon flaticon-twitter-logo-silhouette" title="Twitter"></a> <a href="https://plus.google.com/u/0/116624784918762784912" target="_blank" class="icon flaticon-google-plus-logo-button" title="G+"></a> </div> <div class="author-email"> <a data-email-array='{"16":"m","10":"a","2":"o","4":"m","14":"c","15":"o","3":"u","6":"s","7":"@","1":"t","8":"g","12":"l","9":"m","0":"a","13":".","5":"u","11":"i"}' href="#"></a> </div> <div class="donate"> <a href="http://yasobe.ru/na/atoumus_blog" target="_blank">Поддержать финансово</a> </div> </div> <div class="right"> <div>  <script type="text/javascript"> document.write("<a href='//www.liveinternet.ru/click' "+ "target=_blank><img src='//counter.yadro.ru/hit?t25.5;r"+ escape(document.referrer)+((typeof(screen)=="undefined")?"": ";s"+screen.width+"*"+screen.height+"*"+(screen.colorDepth? screen.colorDepth:screen.pixelDepth))+";u"+escape(document.URL)+ ";"+Math.random()+ "' alt='' title='LiveInternet: показано число посетителей за"+ " сегодня' "+ "border='0' width='88' height='15'><\/a>") </script>  </div> <div> Atoumus Blog &copy; 2011 - 2018 </div> <div> Копирование и цитирование с обязательным указанием URL ссылки на оригинал страницы </div> </div> </div> <div class="clear-both"></div> </div> <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.1.25/jquery.fancybox.min.js"></script> <script type="text/javascript" src="/js/libs/prism.js"></script> <script type="text/javascript" src="/js/common.js"></script> </body> </html>