<!DOCTYPE html> <html lang="en"> <head> <meta charset="UTF-8"> <title>PHP 7.3 - Основные нововведения | Atoumus Blog</title> <link rel="alternate" href="http://atoumus.github.io/php7.3-main-innovations.html" hreflang="ru" /> <link rel="alternate" href="http://atoumus.github.io/en/" hreflang="en" /> <link rel="alternate" type="application/atom+xml" title="Atoumus Blog" href="/atom.xml" /> <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"> <link rel="stylesheet" type="text/css" href="/css/libs/flaticon/flaticon.css"> <link rel="stylesheet" type="text/css" href="/css/libs/prism.css"> <link rel="stylesheet" type="text/css" href="/css/libs/prism-fix.css"> <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.1.25/jquery.fancybox.min.css" /> <link rel="stylesheet" type="text/css" href="/css/common.css"> <meta name="yandex-verification" content="b1ff017a4540ff81" /> </head> <body> <a href="#top" class="elevator"><span class="flaticon-upwards-arrow"></span></a> <a name="top"></a> <div class="main"> <div class="header"> <a href="/" class="logo" title="Atoumus Blog" ><img src="/images/logo.png">Atoumus Blog</a> <form class="search" action="//google.com/search" target="_blank" method="get" accept-charset="UTF-8"> <input type="search" name="q" class="search-input"> <button type="submit">Поиск</button> <input type="hidden" name="sitesearch" value="http://atoumus.github.io"> </form> <div class="social"> <a href="#" class="search-toggle flaticon-magnifier" title="Поиск"></a> <a href="/atom.xml" target="_blank" class="flaticon-rss-feed-button" title="Atom лента"></a> <a href="https://twitter.com/atoumus/" target="_blank" class="flaticon-twitter-logo-silhouette" title="Twitter"></a> </div> </div> <div class="clear-both"></div> <div class="menu"> <div class="tags"> <a href='/'>Главная</a><a href='/tag/PHP/' class='selected'>PHP</a><a href='/tag/Yii/'>Yii</a><a href='/tag/Books/'>Книги</a><a href='/tag/Zend Framework/'>Zend Framework</a><a href='/tag/Drupal/'>Drupal</a><a href='/tag/XDebug/'>XDebug</a><a href='/tag/C Sharp/'>C#</a><a href='/tag/Sublime Text/'>Sublime Text</a><a href='/tag/Others/'>Прочее</a> </div> <div class="lang-switcher"> <span>ru</span><a href='/en/'>en</a> </div> </div> <div class="clear-both"></div> <div class="contents"> <div class="article"> <h1>PHP 7.3 - Основные нововведения</h1> <div class="meta"> <div> <span class="flaticon-calendar-with-spring-binder-and-date-blocks"></span> 2018-12-15 </div> <div> <span class="flaticon-commerce"></span> <a href='/tag/PHP/'>PHP</a> </div> <div class="comments-number"> <span class="flaticon-comment-white-oval-bubble"></span> <a href="#comments" data-disqus-url="http://atoumus.github.io/php7.3-main-innovations.html"></a> </div> </div> <div class="clear-both"></div> <div class="text"><p>6 декабря 2018 года вышел минорный релиз PHP 7.3. Далее, в порядке от более важного к менее важному, будут кратко рассмотрены основные нововведения в данном релизе PHP.</p> <h2>Выброс исключений при ошибках в функциях json_encode() и json_decode()</h2> <p>Если раньше нужно было использовать ф-ю <code>json_last_error()</code>, то теперь можно просто отлавливать исключения. Для этого в функциях <code>json_encode()</code> и <code>json_decode()</code> нужно предавать специальную новую константу <code>JSON_THROW_ON_ERROR</code>:</p> <pre class="line-numbers"><code class="language-php">try {
    json_encode('some invalid data...', JSON_THROW_ON_ERROR);
    json_decode('{', false, 512, JSON_THROW_ON_ERROR); 
} catch (\JsonException $exception) { 
    echo $exception-&gt;getMessage();
}</code></pre> <pre><code>Результат: "Syntax error"</code></pre> <p>Новый <code>\JsonException</code> является наследником от <code>\Exception</code>. Константа <code>JSON_THROW_ON_ERROR</code> и сам <code>JsonException</code> находятся в глобальном пространстве имен.</p> <h2>Новые функции array_key_first() и array_key_last()</h2> <p><code>array_key_first()</code> - Возвращает первый ключ массива.<br/> <code>array_key_last()</code> - Возвращает последний ключ массива.</p> <pre class="line-numbers"><code class="language-php">$colors = [
    'ff0000' =&gt; 'red',
    '00ff00' =&gt; 'green',
    '0000ff' =&gt; 'blue',
];

echo array_key_first($colors) . PHP_EOL;
echo array_key_last($colors);</code></pre> <pre><code>Результат:

ff0000
0000ff</code></pre> <h2>Миграция с PCRE на PCRE2</h2> <p>PHP использует Perl Compatible Regular Expressions или коротко PCRE в библиотеке для работы с регулярными выражениями. С версии PHP 7.2 используется 8.x версия устаревшей библиотеки PCRE, а в PHP 7.3 уже используется PCRE2. Обратите внимание, что PCRE2 считается новой библиотекой, хотя в значительной степени совместима с PCRE (8.x). Новая библиотека более агрессивна к проверке регулярных выражений и может привести к ошибкам в существующем коде, который на более ранних версиях PHP работал стабильно.</p> <h2>Ссылки в list()</h2> <p>В версии PHP 7.3 стало возможным передать элемент массива по ссылке используя <code>list()</code>:</p> <pre class="line-numbers"><code class="language-php">$colors = ['red', 'green'];
list($a, &amp;$b) = $colors;
$b = 'blue';
echo $colors[1];</code></pre> <pre><code>Результат: blue</code></pre> <p>Также вместо ф-и <code>list()</code>можно использовать альтернативный синтаксис с квадратными скобками:</p> <pre class="line-numbers"><code class="language-php">$colors = ['red', 'green'];
[$a, &amp;$b] = $colors; // &lt;--
$b = 'blue';
echo $colors[1];</code></pre> <pre><code>Результат: blue</code></pre> <h2>Регистро-независимые константы объявлены устаревшими</h2> <p>Ранее функция <code>define()</code> позволяла объявить константу в регистро-независимом режиме. Для этого необходимо было явно объявить константу как регистро-независимую, передав третьим параметром <code>true</code>:</p> <pre><code class="language-php">define('Red', 'ff0000', true);</code></pre> <p>Теперь, приведенный выше код будет выбрасывать уведомление: </p> <pre><code>Deprecated: define(): Declaration of case-insensitive constants is deprecated in ...</code></pre> <p>Поэтому дальнейшее использование регистро-независимых констант не рекомендуется, т.к. в дальнейших релизах PHP оно скорее всего вообще будет запрещено.</p> <h2>Добавление функции is_countable()</h2> <p>countable-переменной является массив или объект реализующий <code>\Countable</code> интерфейс. В PHP 7.3 появилась новая функция <code>is_countable()</code>, проверяющая переменную на возможность использования с функцией <code>count()</code>:</p> <pre class="line-numbers"><code class="language-php">$a = 1;
$b = [1, 2, 3];
var_dump(is_countable($a), is_countable($b));</code></pre> <pre><code>Результат: bool(false) bool(true)</code></pre> <h2>Поддержка конечных запятых в вызовах функций и методов</h2> <p>Теперь <strong>разрешено</strong> использование конечных запятых в <strong>вызовах</strong> функций и методах:</p> <pre class="line-numbers"><code class="language-php">function sum($a, $b) {
    return $a + $b;
}

echo sum(2, 2,); // &lt;-- запятая в конце не вызовет ошибку</code></pre> <pre><code>Результат: 4</code></pre> <p>Обратите внимание, что <strong>нельзя</strong> использовать эту возможность в <strong>объявлениях</strong> функций/методов:</p> <pre><code class="language-php">function sum($a, $b,) { // &lt;-- тут запятую в конце ставить нельзя
}</code></pre> <pre><code>Результат: Parse error: syntax error, unexpected ')', expecting variable (T_VARIABLE) in ...</code></pre> <h2>Выброс Notice при использовании не определенной переменной в ф-и compact()</h2> <p>Теперь при передаче в ф-ю <code>compact()</code> неопределенной переменой, выбрасывается <code>Notice</code>:</p> <pre><code class="language-php">$someVars = compact('someUndefinedVar');</code></pre> <pre><code>Результат: Notice: compact(): Undefined variable: someUndefinedVar</code></pre> <h2>Улучшения хеширования паролей с помощью алгоритма Argon2</h2> <p>Алгоритм Argon2 имеет три варианта хеширования: Argon2i, Argon2d и Argon2id. </p> <p>Argon2d работает быстрее и использует зависящий от данных доступ к памяти, что делает его очень устойчивым к атакам с крекингами GPU и подходит для приложений без угроз от атак со сторонних каналов (например, криптовалюты). </p> <p>Argon2i использует независимый от данных доступ к памяти, который предпочтительнее для хеширования паролей но медленнее, поскольку для защиты от атак делает больше проходов по памяти. </p> <p>Argon2id является гибридом Argon2i и Argon2d, и использует комбинацию доступа к данным, зависящим и не зависящим от данных, что дает некоторую устойчивость Argon2i к атакам на кеш-сервер и большую часть устойчивости Argon2d к атакам крекинга GPU.</p> <p>Нововведение добавляет поддержку алгоритма хеширования Argon2id в функциях <code>password_*</code>, добавлена новая константа <code>PASSWORD_ARGON2ID</code>:</p> <pre><code class="language-php">$somePasswordHashed = password_hash('123456', PASSWORD_ARGON2ID);
var_dump(password_verify('123456', $somePasswordHashed));</code></pre> <pre><code>Результат: bool(true)</code></pre> <h2>Смягчение требований к синтаксису Heredoc и Nowdoc</h2> <p>Heredoc и Nowdoc требовали ставить закрывающий идентификатор первым в новой строке. Теперь эти требования убраны. Это сделано для улучшения читабельности кода, прежде всего чтобы можно было добавлять отступы при использовании Heredoc/Nowdoc идентификаторов:</p> <pre class="line-numbers"><code class="language-php">$text = &lt;&lt;&lt;IDENTIFIER        
        Some        
        long        
        text...        
        IDENTIFIER;

echo $text;</code></pre> <pre><code>Результат:

Some
long
text...</code></pre> <h2>Массив опций в функциях для работы с Cookie</h2> <p>В функциях <code>setcookie()</code>, <code>setrawcookie()</code> и <code>session_set_cookie_params()</code> параметры, используемые в заголовке: <code>Set-Cookie</code>, <code>path</code>, <code>domain</code>, <code>secure</code> и <code>httponly</code> - перемещены в параметр <code>$options</code>. При этом текущий вариант реализации, где каждый параметр является отдельным аргументом, остается работоспособным:</p> <pre class="line-numbers"><code class="language-php">bool setcookie ( string $name [, string $value = "" [, int $expire = 0 [, string $path = "" [, string $domain = "" [, bool $secure = false [, bool $httponly = false]]]]]] );
bool setcookie ( string $name [, string $value = "" [, int $expire = 0 [, array $options ]]] );

bool setrawcookie ( string $name [, string $value = "" [, int $expire = 0 [, string $path = "" [, string $domain = "" [, bool $secure = false [, bool $httponly = false]]]]]] );
bool setrawcookie ( string $name [, string $value = "" [, int $expire = 0 [, array $options ]]] );

void session_set_cookie_params ( int $lifetime [, string $path [, string $domain [, bool $secure = false [, bool $httponly = false ]]]] );
void session_set_cookie_params ( int $lifetime [, array $options ] );</code></pre> <p>По-умолчанию параметр <code>$options</code> равен пустой строке. Стандартные значения в этих ф-ях остаются без изменений.</p> <h2>Функция image2wbmp() объявлена устаревшей</h2> <p>Функция <code>image2wbmp()</code> из расширения GD использовалась для вывода изображения в формате WBMP (Wireless Bitmap). Теперь она объявлена устаревшей в пользу функции <code>imagewbmp()</code>.</p> <h2>Флаги FILTER_FLAG_SCHEME_REQUIRED и FILTER_FLAG_HOST_REQUIRED при использовании FILTER_VALIDATE_URL объявлены устаревшими</h2> <p>Когда используется ф-я <code>filter_var($var, FILTER_VALIDATE_URL)</code>, есть два дополнительных флага, которые можно поставить для обеспечения строгой проверки URL-адреса: <code>FILTER_FLAG_SCHEME_REQUIRED</code> и <code>FILTER_FLAG_HOST_REQUIRED</code>. Теперь их использовать запрещено, т.к. их роль по сути и так выполняет константа <code>FILTER_VALIDATE_URL</code>.</p> <h2>Прочие изменения</h2> <p><strong>Добавлено новое исключение <code>CompileError</code>,</strong> наследуемое от <code>ParseError</code> и генерирующее для некоторых типов ошибок перехватываемое событие <code>CompileError</code> вместо фатальной ошибки.</p> <p><strong>Значительно расширены возможности и увеличена производительность дополнения MBString,</strong> в том числе добавлены полноценные средства для манипуляций с регистром символов (<code>MB_CASE_LOWER</code>, <code>MB_CASE_UPPER</code>, <code>MB_CASE_TITLE</code>, <code>MB_CASE_FOLD</code> и т.п.), до версии 11 обновлена поддержка спецификаций Unicode, добавлена поддержка строк, размером больше 2 Гб, в функциях <code>mb_ereg_*()</code> добавлена поддержка именованного захвата элементов. Объявлены устаревшими вызовы <code>mbereg_*()</code>, вместо которых следует использовать <code>mb_ereg_*()</code>.</p> <p><strong>В SAPI-модуль FPM добавлены новые глобальные опции <code>log_limit</code> и <code>log_buffering</code></strong> для ограничения размера выводимой в лог строки и включения режима записи в лог без буферизации. Также добавлена опция <code>decorate_workers_output</code>, позволяющая отключить декорирование вывода от рабочих процессов при активации режима <code>catch_workers_output</code>.</p> <p><strong>В расширении LDAP в большинстве функций, таких как <code>ldap_add</code> и <code>ldap_read</code>,</strong> появился параметр <code>serverctrls</code> для отправки на сервер дополнительных сообщений (LDAP Controls - механизм расширения операций LDAP и передачи дополнительной информации вместе с запросом), а в <code>ldap_parse_result</code> для получения клиентом дополнительных сообщений от сервера. Налажена поддержка режимов <code>LDAP_OPT_SERVER_CONTROLS</code> и <code>LDAP_OPT_CLIENT_CONTROLS</code> в функциях <code>ldap_get_option</code> и <code>ldap_set_option</code>.</p> <p><strong>В расширение GD</strong> в функции <code>imagecreatefromstring()</code> появилась поддержка создания изображений <strong>в формате WebP.</strong></p> <p><strong>Представлена новая функция <code>net_get_interfaces()</code></strong> для получения информации о доступных сетевых интерфейсах.</p> <p>Улучшена работа <strong>сборщика мусора.</strong></p> <p><strong>Приведены к соответствию с поведением Unix операции открытия файлов в Windows:</strong> файловые дескрипторы теперь по умолчанию открываются в Windows в режиме, допускающем чтение, запись и удаление (открытые файлы теперь можно удалить).</p> <h2>Ссылки по теме</h2> <p><a target="_blank" href="http://php.net/releases/7_3_0.php">PHP 7.3.0 Release Announcement</a><br/> <a target="_blank" href="http://php.net/ChangeLog-7.php#7.3.0">PHP ChangeLog Version 7.3.0</a><br/> <a target="_blank" href="https://wiki.php.net/rfc#php_73">RFC PHP 7.3</a><br/> <a target="_blank" href="http://php.net/manual/ru/migration73.php">Миграция с PHP 7.2.x на PHP 7.3.x</a><br/> <a target="_blank" href="http://pcre.org/original/doc/html/pcresyntax.html">PCRE Syntax Man Page (старый)</a><br/> <a target="_blank" href="http://pcre.org/current/doc/html/pcre2syntax.html">PCRE2 Syntax Man Page (новый)</a><br/> <a target="_blank" href="https://gtxtymt.xyz/blog/php-73-whats-new-release-date">PHP 7.3: Изменения / GTXTYMT</a><br/> <a target="_blank" href="https://www.opennet.ru/opennews/art.shtml?num=49732">Релиз языка программирования PHP 7.3 / OpenNET</a><br/></p></div> <div class="related"> <h2>Читайте также</h2> <a href="/php-tech-ratings.html" target="_blank" >PHP Full Stack Web Dev - требования и рейтинг технологий</a> <a href="/php-detect-country-by-ip.html" target="_blank" >PHP - Получаем гео-инфо пользователя по IP</a> <a href="/php-write-read-binary-files.html" target="_blank" >PHP - Запись и чтение бинарных файлов</a> <a href="/php-profiling-xdebug-webgrind.html" target="_blank" >PHP - Профилирование кода с помощью XDebug и WebGrind</a> </div> <div class="share">Поделится: <script type="text/javascript">(function () { if (window.pluso) if (typeof window.pluso.start == "function") return; if (window.ifpluso == undefined) { window.ifpluso = 1; var d = document, s = d.createElement('script'), g = 'getElementsByTagName'; s.type = 'text/javascript'; s.charset = 'UTF-8'; s.async = true; s.src = ('https:' == window.location.protocol ? 'https' : 'http') + '://share.pluso.ru/pluso-like.js'; var h = d[g]('body')[0]; h.appendChild(s); } })();</script> <div class="pluso" data-background="transparent" data-options="small,round,line,horizontal,counter,theme=04" data-services="vkontakte,odnoklassniki,facebook,twitter,google,moimir,email,print"></div></div>   <div class="comments"> <a name="comments"></a> <div id="disqus_thread"></div> <script> var disqus_config = function () { this.page.url = "http://atoumus.github.io/php7.3-main-innovations.html"; this.language = "ru"; }; (function() { var d = document, s = d.createElement('script'); s.src = 'https://atoumus.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript> </div> </div> </div> <div class="footer"> <div class="left"> <div class="social"> <a href="#" class="icon search-toggle flaticon-magnifier" title="Поиск"></a> <a href="/atom.xml" target="_blank" class="icon flaticon-rss-feed-button" title="Atom лента"></a> <a href="https://twitter.com/atoumus/" target="_blank" class="icon flaticon-twitter-logo-silhouette" title="Twitter"></a> </div> <div class="author-email"> <a data-email-array='{"3":"u","2":"o","16":"m","10":"a","11":"i","4":"m","15":"o","13":".","14":"c","1":"t","12":"l","8":"g","6":"s","9":"m","5":"u","7":"@","0":"a"}' href="#"></a> </div> </div> <div class="right"> <div>  <script type="text/javascript"> document.write("<a href='//www.liveinternet.ru/click' "+ "target=_blank><img src='//counter.yadro.ru/hit?t25.5;r"+ escape(document.referrer)+((typeof(screen)=="undefined")?"": ";s"+screen.width+"*"+screen.height+"*"+(screen.colorDepth? screen.colorDepth:screen.pixelDepth))+";u"+escape(document.URL)+ ";"+Math.random()+ "' alt='' title='LiveInternet: показано число посетителей за"+ " сегодня' "+ "border='0' width='88' height='15'><\/a>") </script>  </div> <div> Atoumus Blog &copy; 2011 - 2019 </div> </div> </div> <div class="clear-both"></div> </div> <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.1.25/jquery.fancybox.min.js"></script> <script type="text/javascript" src="/js/libs/prism.js"></script> <script type="text/javascript" src="/js/app.js"></script> </body> </html>